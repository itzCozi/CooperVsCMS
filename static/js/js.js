const prefix=__uv$config.prefix,bare=new BareClient(__uv$config.bare),URL_BAR=document.getElementById("urlbar"),ACTIVE_WINDOW=()=>document.getElementById(getActiveFrameId()).contentWindow,CONTENT_WINDOW=e=>document.getElementById(e).contentWindow,ACTIVE_DOCUMENT=()=>document.getElementById(getActiveFrameId()).contentDocument;let history={},sir=!0;const htHandler=e=>(e=e.slice(5),internal_pages[e]||internal_pages.newtab||alert("something is very wrong, please refresh")),getActiveFrameId=()=>document.querySelector(".chrome-tab[active]")?+document.querySelector(".chrome-tab[active]").getAttribute("ifd")+1:null;function addPageToHistory(e,t){if(!sir){sir=!0;return}e in history||(history[e]=[[],-1]),history[e][1]<history[e][0].length-1&&(history[e][0]=history[e][0].slice(0,history[e][1]+1)),history[e][0][[history[e].length-1]]!=t&&(history[e][0].push(t),history[e][1]=history[e][0].length-1)}function getPage(e){return((history[e]||[])[0]||[])[history[e][1]]||htHandler("ht://newtab")}function getBack(e){return sir=!1,history[e][1]--,getPage(e)}function getForward(e){return history[e][1]>=history[e][0].length-1||(sir=!1,history[e][1]++),getPage(e)}async function getIcon(e){let t=CONTENT_WINDOW(e).document.querySelector('link[rel="favicon"], link[rel="shortcut icon"], link[rel="icon"]');if(null!==t){if(t.href.includes("data:image/png;base64"))return t.href;let a=await bare.fetch(t.href),n=URL.createObjectURL([await a.blob()],{type:a.headers.get("content-type")||"image/x-icon"});return setTimeout(()=>URL.revokeObjectURL(n),1e3),n}{let i=await bare.fetch(new URL("/favicon.ico",CONTENT_WINDOW(e).location)),s=URL.createObjectURL([await i.blob()],{type:i.headers.get("content-type")||"image/x-icon"});return setTimeout(()=>URL.revokeObjectURL(s),1e3),s}}async function setInfo(e){if(CONTENT_WINDOW(e).addEventListener("keydown",function(e){e.ctrlKey&&window.parent.document.getElementsByClassName("chrome-tab")[e.key-1]&&(window.parent.document.getElementsByClassName("chrome-tab")[e.key-1].click(),chromeTabs.setCurrentTab(document.getElementsByClassName("chrome-tab")[e.key-1]))}),CONTENT_WINDOW(e).addEventListener("mousedown",function(){window.parent.hideId("optionsdrop"),window.parent.hideId("ctx"),document.querySelectorAll(".extension_menu")&&document.querySelectorAll(".extension_menu").forEach(e=>e.style.display="none")}),URL_BAR.value="",!CONTENT_WINDOW(e).location.href.includes(__uv$config.prefix)){addPageToHistory(e,CONTENT_WINDOW(e).location.href);return}let t=CONTENT_WINDOW(e).location.href;CONTENT_WINDOW(e).document.getElementsByTagName("title")[0].firstChild.textContent?document.getElementsByClassName(e)[0].firstChild.data=CONTENT_WINDOW(e).document.getElementsByTagName("title")[0].firstChild.textContent:document.getElementsByClassName(e)[0].firstChild.data=xor.decode(t.split(__uv$config.prefix).slice(1).join(__uv$config.prefix)),getActiveFrameId()==e&&(URL_BAR.value=xor.decode(t.split(__uv$config.prefix).slice(1).join(__uv$config.prefix))),document.querySelector(`div[ifd="${+e-1}"]`).children[2].children[0].attributes[1].value=`background-image: url(${await getIcon(e)})`,document.querySelector(`div[ifd="${+e-1}"]`).hasAttribute("tab-is-pinned")&&chromeTabs.pinTab(+e-1),addPageToHistory(e,ACTIVE_WINDOW().location.href)}function hideId(...e){e.forEach(e=>{document.getElementById(e).style.display="none"})}function showId(...e){e.forEach(e=>{document.getElementById(e).style.display="block"})}function toggleId(...e){e.forEach(e=>{"none"===getComputedStyle(document.getElementById(e)).display?showId(e):hideId(e)})}function openMenu(...e){let t=e.map(e=>document.getElementById(e)),a=!0;t.forEach(e=>{"none"!==getComputedStyle(e).display&&(a=!1)}),a?showId(t[0].id):t.forEach(e=>hideId(e.id))}function inspect(){let e=document.createElement("script");e.setAttribute("src","/fbl/firebug-lite-debug.js"),ACTIVE_DOCUMENT().body.appendChild(e)(function(){ACTIVE_WINDOW().firebug.version?ACTIVE_WINDOW().firebug.init():setTimeout(arguments.callee)})()}function opencity(e){let t=document.getElementsByClassName("iframething");for(let a=0;a<t.length;a++)t[a].style.display="none";document.getElementById(e).style="display:inline; background: #FFFFFF",document.getElementById(e).focus();let n=ACTIVE_WINDOW().location.href;URL_BAR.value=xor.decode(n.split(__uv$config.prefix).slice(1).join(__uv$config.prefix))}function skipAd(){for(;""!==ACTIVE_DOCUMENT().getElementsByClassName("video-ads")[0].innerHTML;){for(var e=!1,t=0;t<ACTIVE_DOCUMENT().getElementsByClassName("ytp-ad-overlay-close-button").length;t++)ACTIVE_DOCUMENT().getElementsByClassName("ytp-ad-overlay-close-button")[t].click(),e=!0;!1===e&&(ACTIVE_DOCUMENT().getElementsByClassName("html5-main-video")[0].currentTime=ACTIVE_DOCUMENT().getElementsByClassName("html5-main-video")[0].duration,ACTIVE_DOCUMENT().getElementsByClassName("ytp-ad-skip-button")[0].click())}}let newTab=(e,t=!0)=>{chromeTabs.addTab({title:"New Tab",favicon:"favicon.ico"}),URL_BAR.value="";let a=tabNum++,n=document.createElement("IFRAME");return e.startsWith("ht://")?n.setAttribute("src",htHandler(e)):!1==t?n.setAttribute("src",e):n.setAttribute("src","//"+location.host+__uv$config.prefix+xor.encode(e)),n.setAttribute("allow","fullscreen"),n.setAttribute("sandbox","allow-same-origin allow-scripts allow-popups allow-forms allow-pointer-lock"),document.body.appendChild(n),n.setAttribute("class","iframething"),n.setAttribute("style","display:none background: #FFFFFF"),n.setAttribute("id",a),n.setAttribute("onload","setInfo("+a+")"),opencity(a),document.querySelector(`div[ifd="${+a-1}"]`)},hypertabContainer=document.querySelector(".chrome-tabs"),chromeTabs=new ChromeTabs;chromeTabs.init(hypertabContainer);let tabNum=2,ctxTab=1;document.querySelector("#urlbar").addEventListener("keydown",e=>{if("Enter"!==e.key){try{bare.fetch(`https://duckduckgo.com/ac/?q=${URL_BAR.value}`).then(e=>e.json()).then(e=>{document.getElementById("searchsuggestions").innerHTML="",e.forEach(e=>addEl("option",document.getElementById("searchsuggestions"),{className:"search-opt",value:e.phrase}))})}catch{}return}if(URL_BAR.blur(),URL_BAR.value.startsWith("javascript:")){try{jsUri=decodeURIComponent(URL_BAR.value.substring(11))}catch{jsUri=URL_BAR.value.substring(11)}ACTIVE_WINDOW().eval(jsUri),ACTIVE_DOCUMENT().baseURI.endsWith(location.host+"/internal/newTab/main.php")?URL_BAR.value="":URL_BAR.value=ACTIVE_DOCUMENT().baseURI;return}if(URL_BAR.value.startsWith("ht://")){value=htHandler(URL_BAR.value),document.getElementById(getActiveFrameId()).src=value;return}if(!URL_BAR.value.includes(".")||URL_BAR.value.includes(" ")){value="//"+location.host+__uv$config.prefix+xor.encode(window.searchEngine+encodeURIComponent(URL_BAR.value)),document.getElementById(getActiveFrameId()).src=value,addPageToHistory(getActiveFrameId(),value);return}URL_BAR.value.startsWith("http://")||URL_BAR.value.startsWith("https://")?(value="//"+location.host+__uv$config.prefix+xor.encode(URL_BAR.value),document.getElementById(getActiveFrameId()).src=value):(value="//"+location.host+__uv$config.prefix+xor.encode("http://"+URL_BAR.value),document.getElementById(getActiveFrameId()).src=value),e.preventDefault()}),document.getElementById("optionsdrop").style.display="none","tabbkg"in localStorage||(localStorage.setItem("tabbkg","#202124"),localStorage.setItem("tabhover","#292b2e"),localStorage.setItem("tabact","#323639"),localStorage.setItem("tabacttit","#f1f3f4"),localStorage.setItem("tabinatit","#9ca1a7"),localStorage.setItem("searchbar","#202124"),localStorage.setItem("mockb","#323639"),localStorage.setItem("nt","#FFF"),localStorage.setItem("ua",navigator.userAgent));let items=["tabbkg","tabhover","tabact","tabacttit","tabinatit","searchbar","ua",];function applyTheme(e){switch(e){case"Apply":for(let t=0;t<items.length;t++)localStorage.setItem(items[t],`${document.getElementById(items[t]).value}`);localStorage.setItem("mockb",document.getElementById("tabact").value),location.reload();break;case"Dark":case"Reset":localStorage.setItem("tabbkg","#202124"),localStorage.setItem("tabhover","#202124"),localStorage.setItem("tabact","#323639"),localStorage.setItem("tabacttit","#9ca1a7"),localStorage.setItem("tabacttit","#f1f3f4"),localStorage.setItem("tabinatit","#9ca1a7"),localStorage.setItem("searchbar","#202124"),localStorage.setItem("mockb","#323639"),localStorage.setItem("nt","#FFF"),location.reload();break;case"Light":localStorage.setItem("tabbkg","#f4f5f6"),localStorage.setItem("tabhover","#f4f5f6"),localStorage.setItem("tabact","#fff"),localStorage.setItem("tabacttit","#9ca1a7"),localStorage.setItem("tabacttit","#45474a"),localStorage.setItem("tabinatit","#5f6368"),localStorage.setItem("searchbar","#D0D8E8 "),localStorage.setItem("mockb","#fff"),localStorage.setItem("nt","#323639"),location.reload()}}for(let iframeIndex=0;iframeIndex<items.length;iframeIndex++)document.getElementById(items[iframeIndex]).value=localStorage.getItem(items[iframeIndex]);async function AddBookmark(e){let t=JSON.parse(localStorage.getItem("bookmarks"));console.log(CONTENT_WINDOW(e).location.href+"  "+await getIcon(e)+" "+CONTENT_WINDOW(e).document.getElementsByTagName("title")[0].firstChild.textContent),t.push([CONTENT_WINDOW(e).location.href,await getIcon(e),CONTENT_WINDOW(e).document.getElementsByTagName("title")[0].firstChild.textContent,]),localStorage.setItem("bookmarks",JSON.stringify(t))}function setUA(e){}document.cookie=`cua=${localStorage.getItem("ua")}`,window.onbeforeunload=function(){return"t"},window.searchEngine=localStorage.getItem("searchEngine")||"https://www.google.com/search?q=",document.getElementById("customSearch").value=window.searchEngine,window.toggleActiveExtension=e=>{ActiveExtensions.active.includes(e)?(console.info("== REMOVED extension ====\n"+e),window.ActiveExtensions.active.pop(e)):(console.info("==== ADDED extension ====\n"+e),window.ActiveExtensions.active.push(e)),localStorage.setItem("ActiveExtensions",JSON.stringify(ActiveExtensions)),console.log(localStorage.getItem("ActiveExtensions"))},localStorage.getItem("ActiveExtensions")||localStorage.setItem("ActiveExtensions",'{"active":["core"]}');try{window.ActiveExtensions=JSON.parse(localStorage.getItem("ActiveExtensions"))}catch{alert("ActiveExtensions could not be initialized."),localStorage.setItem("ActiveExtensions",'{"active":["core"]}'),window.ActiveExtensions=JSON.parse('{"active":["core"]}')}if(ActiveExtensions.active.forEach(e=>{console.log("==== ACTIVE EXTENSION ====\n"+e);let t=document.createElement("script");t.setAttribute("src","./js/x/"+e+".js"),document.body.appendChild(t)}),localStorage.getItem("ctPins")){let e=JSON.parse(localStorage.getItem("ctPins"));for(pin in e){var t=newTab(e[pin].url,!1);t.setAttribute("tab-is-pinned",pin),t.classList.add("pin")}}let addEl=(e,t,a)=>Object.assign(t.appendChild(document.createElement(e)),a);newTab("ht://newtab");